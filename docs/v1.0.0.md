# v1.0.0

此文檔描述 `rehype-chinese-punctutation-compression` 在 v1.0.0 需要完成的目標、對其的註釋以及實現方法。

在必要時，請記錄後續版本需要注意之事項。

## 主要目標

在 v1.0.0，需要實現對橫排繁體中文之標點擠壓功能，其具體為：

1. `[x]` 對需要被擠壓的標點符號進行標注
2. `[x]` 對上述任務建立單元測試

在完成任務後，請將上文中的 `[]` 改為 `[x]`。

## 釋義

### rehype

`rehype` 插件是轉換 HTML 抽象語法樹之 `unified` 插件，其使用的 HTML 語法樹是 `hast`。

### 標點擠壓

標點擠壓乃是在中文排版中調整連續標點之間的間距，使文本顯得緊湊的行為。

舉一個例子：

> 她最喜歡的書是《紅樓夢》。

如果此處未經標點擠壓，`》` 與 `。` 之間的間隙便會顯得過大，與文本整體的顯示效果不協調。

### 標點符號之類型

在標點擠壓之流程中，標點符號可分為可擠壓和不可擠壓兩種。

其中，問號 `？` 和感歎號 `！` 不可被擠壓，其固定佔用一個字寬。

可擠壓的標點符號又可以分為：

- 靠左標點：關引號 `」` 和 `』`、關括號 `）` 和關書名號 `》`；
- 靠右標點：開引號 `「` 和 `『`、開括號 `（` 和開書名號 `《`；
- 靠中標點：逗號 `，`、句號 `。`、頓號 `、`、引號 `：`、分號`；` 和間隔號 `．`。

## 實現方法

### 標點擠壓

```
遍歷所有字符：

此字符為靠左標點且
  下一字符為任意標點，則擠壓此標點；

此字符為靠右標點且
  前一字符為靠右或靠中標點，則擠壓此標點；

此字符為靠中標點且
  下一字符為靠左標點，則擠壓此標點。
```

### 標注需被擠壓的標點

我們需要遍歷所有 DOM 中的 Text 節點中的文字，並按照以上規則找出需要擠壓之標點符號，並將其按如下方式標注：

```html
<span class="compressed-punctuation">。</span>
```

### 被擠壓標點的樣式

用戶可以利用 `.compressed-punctuation` 來擠壓標點。一般而言，可以直接使用：

```css
.compressed-punctuation {
  font-feature-settings: 'halt';
}
```

這部分需要用戶手動添加，在 rehype 插件中不作任何處理。

## 後續注意事項

- 對於簡體中文的支持
- 額外標記段落開頭之靠右標點

## Hot Fix

- `[x]` 添加類型以支持 TypeScript（v1.0.1）

## 參考資料

- [Requirements for Chinese Text Layout
  中文排版需求](https://www.w3.org/TR/clreq/)

- [自动处理网页里的全角引号和标点挤压](https://archive.casouri.cc/note/2021/full-width-quote/index.html)
